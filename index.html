<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard de Ventas ‚Äî Marketing</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Carga Chart.js para renderizar gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Hoja de estilos principal (tema, layout y tarjetas) -->
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <!-- Encabezado con t√≠tulo, subt√≠tulo y controles globales -->
    <header>
      <h1>Dashboard de Ventas</h1>
      <div class="sub">
        An√°lisis de productos, ventas, pagos y distribuci√≥n geogr√°fica
      </div>

      <!-- Barra de controles: carga de CSV, tema y ayuda -->
      <div class="controls">
        <!-- Bot√≥n: carga el CSV por defecto desde /data -->
        <button id="btnLoadDefault">
          Cargar CSV por defecto (data/datos_taller_software.csv)
        </button>
        <!-- Separador visual entre acciones -->
        <span class="hint">o</span>
        <!-- Input: permite cargar un CSV local desde el equipo -->
        <input type="file" id="fileInput" accept=".csv" />

        <!-- Bot√≥n: alterna modo claro/oscuro (actualiza tema y charts) -->
        <button id="themeToggle" class="theme-toggle" style="margin-left: auto">
          <span id="themeIcon">üåô</span>
          <span id="themeLabel">Oscuro</span>
        </button>

        <!-- Bot√≥n: muestra/oculta el recuadro de ayuda de filtros -->
        <button
          id="showFiltersHelp"
          class="theme-toggle"
          title="Mostrar u ocultar ayuda de filtros"
          aria-pressed="false"
        >
          <span>‚ùî</span>
          <span id="filtersHelpBtnText">Mostrar ayuda de filtros</span>
        </button>
      </div>
    </header>

    <!-- Contenedor principal de tarjetas, gr√°ficos y tablas -->
    <main class="wrap">
      <!-- KPIs: tarjetas con m√©tricas globales (revenue, unidades, ventas) -->
      <section class="kpis">
        <div class="card kpi">
          <div class="chart-title">Monto TOTAL</div>
          <div class="value" id="kpiRevenue">$0</div>
          <div class="delta" id="kpiRevenueHint"></div>
        </div>
        <div class="card kpi">
          <div class="chart-title">Unidades Vendidas</div>
          <div class="value" id="kpiUnits">0</div>
          <div class="delta" id="kpiUnitsHint"></div>
        </div>
        <div class="card kpi">
          <div class="chart-title">Ventas Totales</div>
          <div class="value" id="kpiTx">0</div>
          <div class="delta" id="kpiTxHint"></div>
        </div>
      </section>

      <!-- Recuadro informativo: tips de uso de filtros (controlado por bot√≥n) -->
      <section class="card info-card" id="infoFilters">
        <div class="info-icon" aria-hidden="true">‚ú®</div>
        <div class="info-content">
          <h3 class="info-title">
            Tip: usa los filtros para explorar tus datos
          </h3>
          <p class="info-text">
            Sobre cada gr√°fico encontrar√°s filtros para
            <strong>categor√≠a</strong>, <strong>m√©todo de pago</strong> y
            <strong>rango de fechas</strong>.
          </p>
          <ul class="info-list">
            <li>Elige una <b>categor√≠a</b> o deja ‚ÄúTodas‚Äù.</li>
            <li>
              Selecciona fecha <b>Desde/Hasta</b> con los calendarios; los
              l√≠mites se ajustan a tus datos.
            </li>
            <li>
              Presiona <b>Aplicar</b> para actualizar el gr√°fico o
              <b>Limpiar</b> para restablecer.
            </li>
          </ul>
        </div>
      </section>

      <!-- Grilla principal de tarjetas de gr√°ficos con sus filtros -->
      <section class="grid">
        <!-- Card: Top 5 productos por cantidad (con filtros de categor√≠a y fecha) -->
        <div class="card chart-card">
          <div class="chart-title">
            <span>Top 5 productos por cantidad</span>
          </div>
          <!-- Form: filtros locales del gr√°fico (category, from, to) -->
          <form class="chart-filters" id="filtersProductsQty">
            <label>
              Categor√≠a
              <select name="category">
                <option value="ALL">Todas</option>
              </select>
            </label>
            <label>
              Desde
              <input type="date" name="from" />
            </label>
            <label>
              Hasta
              <input type="date" name="to" />
            </label>
            <!-- Botones: aplica filtros o limpia el formulario -->
            <button type="button" data-action="apply">Aplicar</button>
            <button type="button" data-action="reset">Limpiar</button>
          </form>
          <!-- Lienzo: destino del gr√°fico de barras -->
          <div class="chart-body">
            <canvas id="chartProductsQty"></canvas>
          </div>
        </div>

        <!-- Card: Top 5 productos por ventas (con filtros de categor√≠a y fecha) -->
        <div class="card chart-card">
          <div class="chart-title"><span>Top 5 productos por Ventas</span></div>
          <!-- Form: filtros locales del gr√°fico (category, from, to) -->
          <form class="chart-filters" id="filtersProductsRevenue">
            <label>
              Categor√≠a
              <select name="category">
                <option value="ALL">Todas</option>
              </select>
            </label>
            <label>
              Desde
              <input type="date" name="from" />
            </label>
            <label>
              Hasta
              <input type="date" name="to" />
            </label>
            <!-- Botones: aplica filtros o limpia el formulario -->
            <button type="button" data-action="apply">Aplicar</button>
            <button type="button" data-action="reset">Limpiar</button>
          </form>
          <!-- Lienzo: destino del gr√°fico de barras -->
          <div class="chart-body">
            <canvas id="chartProductsRevenue"></canvas>
          </div>
        </div>

        <!-- Card: ventas en el tiempo con granularidad (mes/trimestre) y filtros -->
        <div class="card chart-card full" style="grid-column: 1 / -1">
          <div class="chart-title">
            <span>Ventas en el tiempo (por mes / trimestre)</span>
          </div>
          <!-- Form: filtros locales (category, pay, gran, from, to) -->
          <form class="chart-filters" id="filtersTime">
            <label>
              Categor√≠a
              <select name="category">
                <option value="ALL">Todas</option>
              </select>
            </label>
            <label>
              M√©todo de pago
              <select name="pay">
                <option value="ALL">Todos</option>
              </select>
            </label>

            <!-- Selector: define la granularidad temporal del gr√°fico -->
            <label>
              Granularidad
              <select name="gran">
                <option value="month" selected>Mes</option>
                <option value="quarter">Trimestre</option>
              </select>
            </label>

            <label>
              Desde
              <input type="date" name="from" />
            </label>
            <label>
              Hasta
              <input type="date" name="to" />
            </label>
            <!-- Botones: aplica filtros o limpia el formulario -->
            <button type="button" data-action="apply">Aplicar</button>
            <button type="button" data-action="reset">Limpiar</button>
          </form>
          <!-- Lienzo: destino del gr√°fico de l√≠nea -->
          <div class="chart-body">
            <canvas id="chartTime"></canvas>
          </div>
        </div>

        <!-- Card: m√©todos de pago con filtro de categor√≠a y fechas -->
        <div class="card chart-card">
          <div class="chart-title"><span>M√©todos de pago m√°s usados</span></div>
          <!-- Form: filtros locales del gr√°fico (category, from, to) -->
          <form class="chart-filters" id="filtersPayments">
            <label>
              Categor√≠a
              <select name="category">
                <option value="ALL">Todas</option>
              </select>
            </label>
            <label>
              Desde
              <input type="date" name="from" />
            </label>
            <label>
              Hasta
              <input type="date" name="to" />
            </label>
            <!-- Botones: aplica filtros o limpia el formulario -->
            <button type="button" data-action="apply">Aplicar</button>
            <button type="button" data-action="reset">Limpiar</button>
          </form>
          <!-- Lienzo: destino del gr√°fico de dona -->
          <div class="chart-body">
            <canvas id="chartPayments"></canvas>
          </div>
        </div>

        <!-- Card: unidades por categor√≠a (solo rango de fechas) -->
        <div class="card chart-card">
          <div class="chart-title">
            <span>Unidades vendidas por categor√≠a</span>
          </div>
          <!-- Form: filtros locales del gr√°fico (from, to) -->
          <form class="chart-filters" id="filtersCategoriesQty">
            <label>
              Desde
              <input type="date" name="from" />
            </label>
            <label>
              Hasta
              <input type="date" name="to" />
            </label>
            <!-- Botones: aplica filtros o limpia el formulario -->
            <button type="button" data-action="apply">Aplicar</button>
            <button type="button" data-action="reset">Limpiar</button>
          </form>
          <!-- Lienzo: destino del gr√°fico de barras -->
          <div class="chart-body">
            <canvas id="chartCategoriesQty"></canvas>
          </div>
        </div>

        <!-- Card: distribuci√≥n geogr√°fica por regi√≥n o pa√≠s (con filtros) -->
        <div class="card chart-card" style="grid-column: 1 / -1">
          <div class="chart-title">
            <span>Distribuci√≥n de ventas por Regi√≥n / Pa√≠s</span>
          </div>
          <!-- Form: filtros locales del gr√°fico (category, from, to) -->
          <form class="chart-filters" id="filtersGeo">
            <label>
              Categor√≠a
              <select name="category">
                <option value="ALL">Todas</option>
              </select>
            </label>
            <label>
              Desde
              <input type="date" name="from" />
            </label>
            <label>
              Hasta
              <input type="date" name="to" />
            </label>
            <!-- Botones: aplica filtros o limpia el formulario -->
            <button type="button" data-action="apply">Aplicar</button>
            <button type="button" data-action="reset">Limpiar</button>
          </form>
          <!-- Lienzo: destino del gr√°fico de barras -->
          <div class="chart-body">
            <canvas id="chartGeo"></canvas>
          </div>
        </div>
      </section>

      <!-- Secci√≥n de tablas resumen globales (no dependen de filtros de gr√°ficos) -->
      <section class="card">
        <div class="chart-title">
          <span>Resumen ‚Äî Top productos (cantidad y ventas)</span>
        </div>
        <div class="grid">
          <!-- Tabla: top por cantidad (global) -->
          <div>
            <table class="table" id="tableTopQty">
              <thead>
                <tr>
                  <th>Producto</th>
                  <th>Cantidad</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <!-- Tabla: top por ventas (global) -->
          <div>
            <table class="table" id="tableTopRevenue">
              <thead>
                <tr>
                  <th>Producto</th>
                  <th>Ventas</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>
    </main>

    <!-- Pie de p√°gina informativo del stack usado -->
    <footer>Ramo: Ingenier√≠a de Software - Dashboard</footer>

    <!-- Entradas JS: app (datos+gr√°ficos), theme-toggle (tema) e info-tip (ayuda) -->
    <script type="module" src="js/app.js"></script>
    <script type="module" src="js/theme-toggle.js"></script>
    <script type="module" src="js/ui/info-tip.js"></script>
  </body>
</html>
